{"pageProps":{"layoutProps":{"breadcrumbLinks":[{"title":"Developer","url":"/"},{"title":"Terraform","url":"/terraform"},{"title":"Internals","url":"/terraform/internals","isCurrentPage":false},{"title":"Login Protocol","url":"/terraform/internals/login-protocol","isCurrentPage":true}],"sidebarNavDataLevels":[{"levelButtonProps":{"levelDownButtonText":"Terraform Home"},"menuItems":[{"leadingIconName":"home","title":"HashiCorp Developer","href":"/"},{"leadingIconName":"guide","title":"Tutorials","href":"/tutorials"},{"divider":true},{"heading":"Products"},{"leadingIconName":"hcp","title":"HashiCorp Cloud Platform","href":"/hcp"},{"leadingIconName":"terraform","title":"Terraform","href":"/terraform"},{"leadingIconName":"packer","title":"Packer","href":"/packer"},{"leadingIconName":"consul","title":"Consul","href":"/consul"},{"leadingIconName":"vault","title":"Vault","href":"/vault"},{"leadingIconName":"boundary","title":"Boundary","href":"/boundary"},{"leadingIconName":"nomad","title":"Nomad","href":"/nomad"},{"leadingIconName":"waypoint","title":"Waypoint","href":"/waypoint"},{"leadingIconName":"vagrant","title":"Vagrant","href":"/vagrant"}],"showFilterInput":false,"title":"Main Menu"},{"levelButtonProps":{"levelUpButtonText":"Main Menu","levelDownButtonText":"Previous"},"menuItems":[{"title":"Terraform","fullPath":"/terraform","theme":"terraform"},{"title":"Install","fullPath":"/terraform/install"},{"title":"Tutorials","fullPath":"/terraform/tutorials"},{"title":"Documentation","isOpen":true,"routes":[{"title":"About the Docs","fullPath":"/terraform/docs"},{"title":"Configuration Language","fullPath":"/terraform/language"},{"title":"Terraform CLI","fullPath":"/terraform/cli"},{"title":"HCP Terraform","fullPath":"/terraform/cloud-docs"},{"title":"Terraform Enterprise","fullPath":"/terraform/enterprise"},{"title":"CDK for Terraform","fullPath":"/terraform/cdktf"},{"title":"Provider Use","fullPath":"/terraform/language/providers"},{"title":"Plugin Development","fullPath":"/terraform/plugin"},{"title":"Registry Publishing","fullPath":"/terraform/registry"},{"title":"Integration Program","fullPath":"/terraform/docs/partnerships"}]}],"showFilterInput":false,"title":"Terraform","visuallyHideTitle":true},{"backToLinkProps":{"text":"Terraform Home","href":"/terraform"},"levelButtonProps":{"levelUpButtonText":"Terraform Home"},"menuItems":[{"title":"Internals","fullPath":"/terraform/internals","theme":"terraform"},{"title":"Credentials Helpers","path":"credentials-helpers","filePath":"../docs/internals/credentials-helpers.mdx","fullPath":"/terraform/internals/credentials-helpers","id":"sidebar-nav-item-2"},{"title":"Debugging Terraform","path":"debugging","filePath":"../docs/internals/debugging.mdx","fullPath":"/terraform/internals/debugging","id":"sidebar-nav-item-3"},{"title":"Module Registry Protocol","path":"module-registry-protocol","filePath":"../docs/internals/module-registry-protocol.mdx","fullPath":"/terraform/internals/module-registry-protocol","id":"sidebar-nav-item-4"},{"title":"Provider Network Mirror Protocol","path":"provider-network-mirror-protocol","filePath":"../docs/internals/provider-network-mirror-protocol.mdx","fullPath":"/terraform/internals/provider-network-mirror-protocol","id":"sidebar-nav-item-5"},{"title":"Provider Registry Protocol","path":"provider-registry-protocol","filePath":"../docs/internals/provider-registry-protocol.mdx","fullPath":"/terraform/internals/provider-registry-protocol","id":"sidebar-nav-item-6"},{"title":"Resource Graph","path":"graph","filePath":"../docs/internals/graph.mdx","fullPath":"/terraform/internals/graph","id":"sidebar-nav-item-7"},{"title":"Login Protocol","path":"login-protocol","filePath":"../docs/internals/login-protocol.mdx","fullPath":"/terraform/internals/login-protocol","id":"sidebar-nav-item-8"},{"title":"JSON Output Format","path":"json-format","filePath":"../docs/internals/json-format.mdx","fullPath":"/terraform/internals/json-format","id":"sidebar-nav-item-9"},{"title":"Remote Service Discovery","path":"remote-service-discovery","filePath":"../docs/internals/remote-service-discovery.mdx","fullPath":"/terraform/internals/remote-service-discovery","id":"sidebar-nav-item-10"},{"title":"Provider Metadata","path":"provider-meta","filePath":"../docs/internals/provider-meta.mdx","fullPath":"/terraform/internals/provider-meta","id":"sidebar-nav-item-11"},{"title":"Functions Metadata","path":"functions-meta","filePath":"../docs/internals/functions-meta.mdx","fullPath":"/terraform/internals/functions-meta","id":"sidebar-nav-item-12"},{"title":"Machine Readable UI","path":"machine-readable-ui","filePath":"../docs/internals/machine-readable-ui.mdx","fullPath":"/terraform/internals/machine-readable-ui","id":"sidebar-nav-item-13"},{"divider":true,"id":"sidebar-nav-item-14"},{"title":"Terraform CLI","href":null,"fullPath":"/terraform/cli","id":"sidebar-nav-item-15","path":"/cli"},{"divider":true,"id":"sidebar-nav-item-16"},{"title":"Configuration Language","href":null,"fullPath":"/terraform/language","id":"sidebar-nav-item-17","path":"/language"}],"title":"Internals","visuallyHideTitle":true}],"mainWidth":"narrow","githubFileUrl":"https://github.com/hashicorp/terraform/blob/main/website/../docs/internals/login-protocol.mdx"},"metadata":{"title":"Login Protocol","description":"The login protocol is used for authenticating Terraform against servers providing Terraform-native services.","layout":null},"outlineItems":[{"title":"Server-side Login Protocol","url":"#server-side-login-protocol","dataHeapTrack":"toc-list-item-index-0"}],"pageHeading":{"id":"server-side-login-protocol","title":"Server-side Login Protocol"},"mdxSource":{"compiledSource":"const layoutProps={};const MDXLayout=\"wrapper\";function MDXContent({components,...props}){return mdx(MDXLayout,{...layoutProps,...props,components:components,mdxType:\"MDXLayout\"},mdx(\"div\",{\"className\":\"alert alert-warning g-type-body\"},mdx(\"p\",{parentName:\"div\"},``,mdx(\"strong\",{parentName:\"p\"},`Note:`),` You don't need to read these docs to `,mdx(\"em\",{parentName:\"p\"},`use`),`\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/terraform/cli/commands/login\"},mdx(\"inlineCode\",{parentName:\"a\"},`terraform login`)),`.  The information below is for\nanyone intending to implement the server side of `,mdx(\"inlineCode\",{parentName:\"p\"},`terraform login`),` in order to\noffer Terraform-native services in a third-party system.`)),mdx(\"p\",null,`The `,mdx(\"inlineCode\",{parentName:\"p\"},`terraform login`),` command supports performing an OAuth 2.0 authorization\nrequest using configuration provided by the target host. You may wish to\nimplement this protocol if you are producing a third-party implementation of\nany `,mdx(\"a\",{parentName:\"p\",\"href\":\"/terraform/internals/remote-service-discovery\"},`Terraform-native services`),`,\nsuch as a Terraform module registry.`),mdx(\"p\",null,`First, Terraform uses\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/terraform/internals/remote-service-discovery\"},`remote service discovery`),` to\nfind the OAuth configuration for the host. The host must support the service\nname `,mdx(\"inlineCode\",{parentName:\"p\"},`login.v1`),` and define for it an object containing OAuth client\nconfiguration values, like this:`),mdx(\"pre\",{\"className\":\"language-json\"},mdx(\"code\",{parentName:\"pre\",\"className\":\"language-json\"},mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"login.v1\"`),mdx(\"span\",{parentName:\"code\",\"className\":\"token operator\"},`:`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"client\"`),mdx(\"span\",{parentName:\"code\",\"className\":\"token operator\"},`:`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"terraform-cli\"`),mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`,`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"grant_types\"`),mdx(\"span\",{parentName:\"code\",\"className\":\"token operator\"},`:`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`[`),mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"authz_code\"`),mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`]`),mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`,`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"authz\"`),mdx(\"span\",{parentName:\"code\",\"className\":\"token operator\"},`:`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"/oauth/authorization\"`),mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`,`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"token\"`),mdx(\"span\",{parentName:\"code\",\"className\":\"token operator\"},`:`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"/oauth/token\"`),mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`,`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"ports\"`),mdx(\"span\",{parentName:\"code\",\"className\":\"token operator\"},`:`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`[`),mdx(\"span\",{parentName:\"code\",\"className\":\"token number\"},`10000`),mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`,`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token number\"},`10010`),mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`]`),mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`,`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`)),mdx(\"p\",null,`The properties within the discovery object are as follows:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"client\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"p\",{parentName:\"li\"},mdx(\"a\",{parentName:\"p\",\"href\":\"#client\",\"aria-label\":\"client permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`client`)),` (Required): The `,mdx(\"inlineCode\",{parentName:\"p\"},`client_id`),` value to use when making requests, as\ndefined in `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://tools.ietf.org/html/rfc6749#section-2.2\"},`RFC 6749 section 2.2`),`.`),mdx(\"p\",{parentName:\"li\"},`Because Terraform is a `,mdx(\"em\",{parentName:\"p\"},`public client`),` (it is installed on end-user systems\nand thus cannot protect an OAuth client secret), the `,mdx(\"inlineCode\",{parentName:\"p\"},`client_id`),` is purely\nadvisory and the server must not use it as a guarantee that an authorization\nrequest is truly coming from Terraform.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"grant_types\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"p\",{parentName:\"li\"},mdx(\"a\",{parentName:\"p\",\"href\":\"#grant_types\",\"aria-label\":\"grant_types permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`grant_types`)),` (Optional): A JSON array of strings describing a set of OAuth\n2.0 grant types the server is able to support. A \"grant type\" selects a\nspecific mechanism by which an OAuth server authenticates the request and\nissues an authorization token.`),mdx(\"p\",{parentName:\"li\"},`Terraform CLI supports a single grant type:`),mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"authz_code\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#authz_code\",\"aria-label\":\"authz_code permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`authz_code`)),`: `,mdx(\"a\",{parentName:\"li\",\"href\":\"https://tools.ietf.org/html/rfc6749#section-4.1\"},`authorization code grant`),`.\nBoth the `,mdx(\"inlineCode\",{parentName:\"li\"},`authz`),` and `,mdx(\"inlineCode\",{parentName:\"li\"},`token`),` properties are required when `,mdx(\"inlineCode\",{parentName:\"li\"},`authz_code`),` is\npresent.`)),mdx(\"p\",{parentName:\"li\"},`If not specified, `,mdx(\"inlineCode\",{parentName:\"p\"},`grant_types`),` defaults to `,mdx(\"inlineCode\",{parentName:\"p\"},`[\"authz_code\"]`),`.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"authz\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"p\",{parentName:\"li\"},mdx(\"a\",{parentName:\"p\",\"href\":\"#authz\",\"aria-label\":\"authz permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`authz`)),` (Required if needed for a given grant type): the server's\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://tools.ietf.org/html/rfc6749#section-3.1\"},`authorization endpoint`),`.\nIf given as a relative URL, it is resolved from the location of the\nservice discovery document.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"token\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"p\",{parentName:\"li\"},mdx(\"a\",{parentName:\"p\",\"href\":\"#token\",\"aria-label\":\"token permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`token`)),` (Required if needed for a given grant type): the server's\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://tools.ietf.org/html/rfc6749#section-3.2\"},`token endpoint`),`.\nIf given as a relative URL, it is resolved from the location of the\nservice discovery document.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"ports\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"p\",{parentName:\"li\"},mdx(\"a\",{parentName:\"p\",\"href\":\"#ports\",\"aria-label\":\"ports permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`ports`)),` (Optional): A two-element JSON array giving an inclusive range of\nTCP ports that Terraform may use for the temporary HTTP server it will start\nto provide the `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://tools.ietf.org/html/rfc6749#section-3.1.2\"},`redirection endpoint`),`\nfor the first step of an authorization code grant. Terraform opens a TCP\nlisten port on the loopback interface in order to receive the response from\nthe server's authorization endpoint.`),mdx(\"p\",{parentName:\"li\"},`If not specified, Terraform is free to select any TCP port greater than or\nequal to 1024.`),mdx(\"p\",{parentName:\"li\"},`Terraform allows constraining this port range for interoperability with OAuth\nserver implementations that require each `,mdx(\"inlineCode\",{parentName:\"p\"},`client_id`),` to be associated with\na fixed set of valid redirection endpoint URLs. Configure such a server\nto expect a range of URLs of the form `,mdx(\"inlineCode\",{parentName:\"p\"},`http://localhost:10000/`),`\nwith different consecutive port numbers, and then specify that port range\nusing `,mdx(\"inlineCode\",{parentName:\"p\"},`ports`),`.`),mdx(\"p\",{parentName:\"li\"},`We recommend allowing at least 10 distinct port numbers if possible, and\nassigning them to numbers greater than or equal to 10000, to minimize the\nrisk that all of the possible ports will already be in use on a particular\nsystem.`))),mdx(\"p\",null,`When requesting an authorization code grant, Terraform CLI implements the\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://tools.ietf.org/html/rfc7636\"},`Proof Key for Code Exchange`),` extension in\norder to protect against other applications on the system intercepting the\nincoming request to the redirection endpoint. We strongly recommend that you\nselect an OAuth server implementation that also implements this extension and\nverifies the code challenge sent to the token endpoint.`),mdx(\"p\",null,`Terraform CLI does not support OAuth refresh tokens or token expiration. If your\nserver issues time-limited tokens, Terraform CLI will simply begin receiving\nauthorization errors once the token expires, after which the user can run\n`,mdx(\"inlineCode\",{parentName:\"p\"},`terraform login`),` again to obtain a new token.`),mdx(\"div\",{\"className\":\"alert alert-info g-type-body\"},mdx(\"p\",{parentName:\"div\"},``,mdx(\"strong\",{parentName:\"p\"},`Note:`),` As a special case, Terraform can use a\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://tools.ietf.org/html/rfc6749#section-4.3\"},`Resource Owner Password Credentials Grant`),`\nonly when interacting with `,mdx(\"inlineCode\",{parentName:\"p\"},`app.terraform.io`),` (`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://cloud.hashicorp.com/products/terraform\"},`HCP Terraform`),`),\nunder the recommendation in the OAuth specification to use this grant type only\nwhen the client and server are closely related. The `,mdx(\"inlineCode\",{parentName:\"p\"},`password`),` grant type is\nnot supported for any other hostname and will be ignored.`)))};MDXContent.isMDXComponent=true;","scope":{"version":"latest"}},"product":{"slug":"terraform","name":"Terraform","algoliaConfig":{"indexName":"product_TERRAFORM"},"alertBannerActive":true,"alertBanner":{"tag":"New","url":"https://www.hashicorp.com/blog/introducing-the-infrastructure-cloud","text":"Terraform Cloud is now HCP Terraform","linkText":"Read more â†’","expirationDate":"2024-04-29T00:00:00-08:00"},"basePaths":["cdktf","cli","cloud-docs","cloud-docs/agents","docs","enterprise","internals","intro","language","plugin","plugin/framework","plugin/log","plugin/mux","plugin/sdkv2","plugin/testing","registry","downloads"],"docsNavItems":["docs","language","cli","cloud-docs","enterprise","cdktf",{"icon":"provider","label":"Provider Use","fullPath":"/terraform/language/providers"},"plugin","registry",{"icon":"handshake","label":"Integration Program","fullPath":"/terraform/docs/partnerships"}],"rootDocsPaths":[{"iconName":"code","name":"CDK for Terraform","path":"cdktf","productSlugForLoader":"terraform-cdk"},{"iconName":"terminal-screen","name":"Terraform CLI","path":"cli"},{"iconName":"cloud","name":"HCP Terraform","path":"cloud-docs","productSlugForLoader":"terraform-docs-common"},{"iconName":"cloud","name":"Cloud Docs Agents","navDataPrefix":"cloud-docs-agents","path":"cloud-docs/agents","productSlugForLoader":"terraform-docs-agents"},{"iconName":"docs","name":"About the Docs","path":"docs","productSlugForLoader":"terraform-docs-common"},{"iconName":"org","name":"Terraform Enterprise","path":"enterprise","productSlugForLoader":"ptfe-releases"},{"iconName":"docs","name":"Internals","path":"internals"},{"iconName":"docs","name":"Intro","path":"intro"},{"iconName":"file-source","name":"Configuration Language","path":"language"},{"iconName":"wrench","name":"Plugin Development","path":"plugin","productSlugForLoader":"terraform-docs-common"},{"iconName":"plug","name":"Framework","navDataPrefix":"plugin-framework","path":"plugin/framework","productSlugForLoader":"terraform-plugin-framework"},{"iconName":"plug","name":"Logging","navDataPrefix":"plugin-log","path":"plugin/log","productSlugForLoader":"terraform-plugin-log"},{"iconName":"plug","name":"Combining and Translating","navDataPrefix":"plugin-mux","path":"plugin/mux","productSlugForLoader":"terraform-plugin-mux"},{"iconName":"plug","name":"SDKv2","path":"plugin/sdkv2","productSlugForLoader":"terraform-plugin-sdk","navDataPrefix":"plugin-sdkv2"},{"iconName":"plug","name":"Testing","path":"plugin/testing","productSlugForLoader":"terraform-plugin-testing","navDataPrefix":"plugin-testing"},{"iconName":"plus-circle","name":"Registry Publishing","path":"registry","productSlugForLoader":"terraform-docs-common"}],"currentRootDocsPath":{"iconName":"docs","name":"Internals","path":"internals"}},"projectName":null,"versions":null},"__N_SSG":true}