{"pageProps":{"layoutProps":{"breadcrumbLinks":[{"title":"Developer","url":"/"},{"title":"Terraform","url":"/terraform"},{"title":"Internals","url":"/terraform/internals","isCurrentPage":false},{"title":"Dependency Graph","url":"/terraform/internals/graph","isCurrentPage":true}],"sidebarNavDataLevels":[{"levelButtonProps":{"levelDownButtonText":"Terraform Home"},"menuItems":[{"leadingIconName":"home","title":"HashiCorp Developer","href":"/"},{"leadingIconName":"guide","title":"Tutorials","href":"/tutorials"},{"divider":true},{"heading":"Products"},{"leadingIconName":"hcp","title":"HashiCorp Cloud Platform","href":"/hcp"},{"leadingIconName":"terraform","title":"Terraform","href":"/terraform"},{"leadingIconName":"packer","title":"Packer","href":"/packer"},{"leadingIconName":"consul","title":"Consul","href":"/consul"},{"leadingIconName":"vault","title":"Vault","href":"/vault"},{"leadingIconName":"boundary","title":"Boundary","href":"/boundary"},{"leadingIconName":"nomad","title":"Nomad","href":"/nomad"},{"leadingIconName":"waypoint","title":"Waypoint","href":"/waypoint"},{"leadingIconName":"vagrant","title":"Vagrant","href":"/vagrant"}],"showFilterInput":false,"title":"Main Menu"},{"levelButtonProps":{"levelUpButtonText":"Main Menu","levelDownButtonText":"Previous"},"menuItems":[{"title":"Terraform","fullPath":"/terraform","theme":"terraform"},{"title":"Install","fullPath":"/terraform/install"},{"title":"Intro to Terraform","fullPath":"/terraform/intro"},{"title":"Tutorials","fullPath":"/terraform/tutorials"},{"title":"Documentation","isOpen":true,"routes":[{"title":"Documentation","fullPath":"/terraform/docs"},{"title":"Configuration Language","fullPath":"/terraform/language"},{"title":"Terraform CLI","fullPath":"/terraform/cli"},{"title":"HCP Terraform","fullPath":"/terraform/cloud-docs"},{"title":"Terraform Enterprise","fullPath":"/terraform/enterprise"},{"title":"CDK for Terraform","fullPath":"/terraform/cdktf"},{"title":"Provider Use","fullPath":"/terraform/language/providers"},{"title":"Plugin Development","fullPath":"/terraform/plugin"},{"title":"Registry Publishing","fullPath":"/terraform/registry"},{"title":"Integration Program","fullPath":"/terraform/docs/partnerships"}]}],"showFilterInput":false,"title":"Terraform","visuallyHideTitle":true},{"backToLinkProps":{"text":"Terraform Home","href":"/terraform"},"levelButtonProps":{"levelUpButtonText":"Terraform Home"},"menuItems":[{"title":"Internals","fullPath":"/terraform/internals","theme":"terraform"},{"title":"Credentials Helpers","path":"credentials-helpers","filePath":"../docs/internals/credentials-helpers.mdx","fullPath":"/terraform/internals/credentials-helpers","id":"sidebar-nav-item-2"},{"title":"Debugging Terraform","path":"debugging","filePath":"../docs/internals/debugging.mdx","fullPath":"/terraform/internals/debugging","id":"sidebar-nav-item-3"},{"title":"Module Registry Protocol","path":"module-registry-protocol","filePath":"../docs/internals/module-registry-protocol.mdx","fullPath":"/terraform/internals/module-registry-protocol","id":"sidebar-nav-item-4"},{"title":"Provider Network Mirror Protocol","path":"provider-network-mirror-protocol","filePath":"../docs/internals/provider-network-mirror-protocol.mdx","fullPath":"/terraform/internals/provider-network-mirror-protocol","id":"sidebar-nav-item-5"},{"title":"Provider Registry Protocol","path":"provider-registry-protocol","filePath":"../docs/internals/provider-registry-protocol.mdx","fullPath":"/terraform/internals/provider-registry-protocol","id":"sidebar-nav-item-6"},{"title":"Dependency Graph","path":"graph","filePath":"../docs/internals/graph.mdx","fullPath":"/terraform/internals/graph","id":"sidebar-nav-item-7"},{"title":"Login Protocol","path":"login-protocol","filePath":"../docs/internals/login-protocol.mdx","fullPath":"/terraform/internals/login-protocol","id":"sidebar-nav-item-8"},{"title":"JSON Output Format","path":"json-format","filePath":"../docs/internals/json-format.mdx","fullPath":"/terraform/internals/json-format","id":"sidebar-nav-item-9"},{"title":"Remote Service Discovery","path":"remote-service-discovery","filePath":"../docs/internals/remote-service-discovery.mdx","fullPath":"/terraform/internals/remote-service-discovery","id":"sidebar-nav-item-10"},{"title":"Provider Metadata","path":"provider-meta","filePath":"../docs/internals/provider-meta.mdx","fullPath":"/terraform/internals/provider-meta","id":"sidebar-nav-item-11"},{"title":"Functions Metadata","path":"functions-meta","filePath":"../docs/internals/functions-meta.mdx","fullPath":"/terraform/internals/functions-meta","id":"sidebar-nav-item-12"},{"title":"Machine Readable UI","path":"machine-readable-ui","filePath":"../docs/internals/machine-readable-ui.mdx","fullPath":"/terraform/internals/machine-readable-ui","id":"sidebar-nav-item-13"},{"divider":true,"id":"sidebar-nav-item-14"},{"title":"Terraform CLI","href":null,"fullPath":"/terraform/cli","id":"sidebar-nav-item-15","path":"/cli"},{"divider":true,"id":"sidebar-nav-item-16"},{"title":"Configuration Language","href":null,"fullPath":"/terraform/language","id":"sidebar-nav-item-17","path":"/language"}],"title":"Internals","visuallyHideTitle":true}],"mainWidth":"narrow","githubFileUrl":"https://github.com/hashicorp/terraform/blob/main/website/../docs/internals/graph.mdx"},"metadata":{"title":"Dependency Graph","description":"Learn how Terraform builds a dependency graph from the Terraform configurations and uses the graph to generate plans, refresh state, perform other operations. ","layout":null},"outlineItems":[{"title":"Dependency Graph","url":"#dependency-graph"},{"title":"Introduction","url":"#introduction"},{"title":"Graph Nodes","url":"#graph-nodes"},{"title":"Building the Graph","url":"#building-the-graph"},{"title":"Walking the Graph","url":"#walking-the-graph"}],"pageHeading":{"id":"dependency-graph","title":"Dependency Graph"},"mdxSource":{"compiledSource":"const layoutProps={};const MDXLayout=\"wrapper\";function MDXContent({components,...props}){return mdx(MDXLayout,{...layoutProps,...props,components:components,mdxType:\"MDXLayout\"},mdx(\"p\",null,`⚠️⚠️⚠️⚠️⚠️⚠️⚠️⚠️⚠️⚠️⚠️⚠️`),mdx(\"blockquote\",null,mdx(\"p\",{parentName:\"blockquote\"},`[!IMPORTANT]`,mdx(\"br\",{parentName:\"p\"}),`\n`,mdx(\"strong\",{parentName:\"p\"},`Documentation Update:`),` Product documentation previously located in `,mdx(\"inlineCode\",{parentName:\"p\"},`/website`),` has moved to the `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/web-unified-docs\"},mdx(\"inlineCode\",{parentName:\"a\"},`hashicorp/web-unified-docs`)),` repository, where all product documentation is now centralized. Please make contributions directly to `,mdx(\"inlineCode\",{parentName:\"p\"},`web-unified-docs`),`, since changes to `,mdx(\"inlineCode\",{parentName:\"p\"},`/website`),` in this repository will not appear on developer.hashicorp.com.\n⚠️⚠️⚠️⚠️⚠️⚠️⚠️⚠️⚠️⚠️⚠️⚠️`)),mdx(\"p\",null,`This topic explains the dependency graph Terraform builds from Terraform configurations. This is an advanced topic and not required to understand how to use Terraform. `),mdx(\"h2\",{\"id\":\"introduction\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#introduction\",\"aria-label\":\"introduction permalink\"},`\\xbb`),`Introduction`),mdx(\"p\",null,`Terraform builds a dependency graph and uses it to perform operations, such as generate plans and refresh state.\nFor background on graph theory and a summary of how\nTerraform applies it, refer the HashiCorp 2016 presentation\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://www.youtube.com/watch?v=Ce3RNfRbdZ0\"},mdx(\"em\",{parentName:\"a\"},`Applying Graph Theory to Infrastructure as Code`)),`.`),mdx(\"h2\",{\"id\":\"graph-nodes\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#graph-nodes\",\"aria-label\":\"graph nodes permalink\"},`\\xbb`),`Graph Nodes`),mdx(\"p\",null,`The following node types can exist within the graph:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"strong\",{parentName:\"p\"},`Resource Node`),` - Represents a single resource. If you have\nthe `,mdx(\"inlineCode\",{parentName:\"p\"},`count`),` metaparameter set, then there will be one resource\nnode for each count. The configuration, diff, state, etc. of\nthe resource under change is attached to this node.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"strong\",{parentName:\"p\"},`Provider Configuration Node`),` - Represents the time to fully\nconfigure a provider. This is when the provider configuration\nblock is given to a provider, such as AWS security credentials.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"strong\",{parentName:\"p\"},`Resource Meta-Node`),` - Represents a group of resources, but\ndoes not represent any action on its own. This is done for\nconvenience on dependencies and making a prettier graph. This\nnode is only present for resources that have a `,mdx(\"inlineCode\",{parentName:\"p\"},`count`),`\nparameter greater than 1.`))),mdx(\"p\",null,`When visualizing a configuration with `,mdx(\"inlineCode\",{parentName:\"p\"},`terraform graph`),`, you can\nsee all of these nodes present.`),mdx(\"h2\",{\"id\":\"building-the-graph\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#building-the-graph\",\"aria-label\":\"building the graph permalink\"},`\\xbb`),`Building the Graph`),mdx(\"p\",null,`Building the graph is done in a series of sequential steps:`),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`Resources nodes are added based on the configuration. If a\ndiff (plan) or state is present, that meta-data is attached\nto each resource node.`)),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`Resources are mapped to provisioners if they have any\ndefined. This must be done after all resource nodes are\ncreated so resources with the same provisioner type can\nshare the provisioner implementation.`)),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`Explicit dependencies from the `,mdx(\"inlineCode\",{parentName:\"p\"},`depends_on`),` meta-parameter\nare used to create edges between resources.`)),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`If a state is present, any \"orphan\" resources are added to\nthe graph. Orphan resources are any resources that are no\nlonger present in the configuration but are present in the\nstate file. Orphans never have any configuration associated\nwith them, since the state file does not store configuration.`)),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`Resources are mapped to providers. Provider configuration\nnodes are created for these providers, and edges are created\nsuch that the resources depend on their respective provider\nbeing configured.`)),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`Interpolations are parsed in resource and provider configurations\nto determine dependencies. References to resource attributes\nare turned into dependencies from the resource with the interpolation\nto the resource being referenced.`)),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`Create a root node. The root node points to all resources and\nis created so there is a single root to the dependency graph. When\ntraversing the graph, the root node is ignored.`)),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`If a diff is present, traverse all resource nodes and find resources\nthat are being destroyed. These resource nodes are split into two:\none node that destroys the resource and another that creates\nthe resource (if it is being recreated). The reason the nodes must\nbe split is because the destroy order is often different from the\ncreate order, and so they can't be represented by a single graph\nnode.`)),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`Validate the graph has no cycles and has a single root.`))),mdx(\"h2\",{\"id\":\"walking-the-graph\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#walking-the-graph\",\"aria-label\":\"walking the graph permalink\"},`\\xbb`),`Walking the Graph`),mdx(\"a\",{id:\"walking-the-graph\"}),mdx(\"p\",null,`To walk the graph, a standard depth-first traversal is done. Graph\nwalking is done in parallel: a node is walked as soon as all of its\ndependencies are walked.`),mdx(\"p\",null,`The amount of parallelism is limited using a semaphore to prevent too many\nconcurrent operations from overwhelming the resources of the machine running\nTerraform. By default, up to 10 nodes in the graph will be processed\nconcurrently. This number can be set using the `,mdx(\"inlineCode\",{parentName:\"p\"},`-parallelism`),` flag on the\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/terraform/cli/commands/plan\"},`plan`),`, `,mdx(\"a\",{parentName:\"p\",\"href\":\"/terraform/cli/commands/apply\"},`apply`),`, and\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/terraform/cli/commands/destroy\"},`destroy`),` commands.`),mdx(\"p\",null,`Setting `,mdx(\"inlineCode\",{parentName:\"p\"},`-parallelism`),` is considered an advanced operation and should not be\nnecessary for normal usage of Terraform. It may be helpful in certain special\nuse cases or to help debug Terraform issues.`),mdx(\"p\",null,`Note that some providers (AWS, for example), handle API rate limiting issues at\na lower level by implementing graceful backoff/retry in their respective API\nclients. For this reason, Terraform does not use this `,mdx(\"inlineCode\",{parentName:\"p\"},`parallelism`),` feature to\naddress API rate limits directly.`))};MDXContent.isMDXComponent=true;","scope":{"product":"terraform","version":"latest"}},"product":{"slug":"terraform","name":"Terraform","algoliaConfig":{"indexName":"product_TERRAFORM"},"alertBannerActive":true,"alertBanner":{"tag":"New","url":"https://www.hashicorp.com/blog/introducing-the-infrastructure-cloud","text":"Terraform Cloud is now HCP Terraform","linkText":"Read more →","expirationDate":"2024-04-29T00:00:00-08:00"},"basePaths":["cdktf","cli","cloud-docs","cloud-docs/agents","docs","enterprise","internals","intro","language","plugin","plugin/framework","plugin/log","plugin/mux","plugin/sdkv2","plugin/testing","registry","downloads"],"docsNavItems":["docs","intro","language","cli","cloud-docs","enterprise","cdktf",{"icon":"provider","label":"Provider Use","fullPath":"/terraform/language/providers"},"plugin","registry",{"icon":"handshake","label":"Integration Program","fullPath":"/terraform/docs/partnerships"}],"rootDocsPaths":[{"iconName":"code","name":"CDK for Terraform","path":"cdktf","productSlugForLoader":"terraform-cdk"},{"iconName":"terminal-screen","name":"Terraform CLI","path":"cli"},{"iconName":"cloud","name":"HCP Terraform","path":"cloud-docs","productSlugForLoader":"terraform-docs-common"},{"iconName":"cloud","name":"HCP Terraform Agents","navDataPrefix":"cloud-docs-agents","path":"cloud-docs/agents","productSlugForLoader":"terraform-docs-agents"},{"iconName":"docs","name":"Documentation","path":"docs","productSlugForLoader":"terraform-docs-common"},{"iconName":"org","name":"Terraform Enterprise","path":"enterprise","productSlugForLoader":"terraform-enterprise"},{"iconName":"docs","name":"Internals","path":"internals"},{"iconName":"docs","name":"Intro to Terraform","path":"intro"},{"iconName":"file-source","name":"Configuration Language","path":"language"},{"iconName":"wrench","name":"Plugin Development","path":"plugin","productSlugForLoader":"terraform-docs-common"},{"iconName":"plug","name":"Framework","navDataPrefix":"plugin-framework","path":"plugin/framework","productSlugForLoader":"terraform-plugin-framework"},{"iconName":"plug","name":"Logging","navDataPrefix":"plugin-log","path":"plugin/log","productSlugForLoader":"terraform-plugin-log"},{"iconName":"plug","name":"Combining and Translating","navDataPrefix":"plugin-mux","path":"plugin/mux","productSlugForLoader":"terraform-plugin-mux"},{"iconName":"plug","name":"SDKv2","path":"plugin/sdkv2","productSlugForLoader":"terraform-plugin-sdk","navDataPrefix":"plugin-sdkv2"},{"iconName":"plug","name":"Testing","path":"plugin/testing","productSlugForLoader":"terraform-plugin-testing","navDataPrefix":"plugin-testing"},{"iconName":"plus-circle","name":"Registry Publishing","path":"registry","productSlugForLoader":"terraform-docs-common"}],"currentRootDocsPath":{"iconName":"docs","name":"Internals","path":"internals"}},"projectName":null,"versions":null},"__N_SSG":true}